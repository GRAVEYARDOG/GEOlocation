<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Phone Location + Leaflet</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <script>
  const map = L.map('map').setView([0, 0], 2);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '© OpenStreetMap contributors'
  }).addTo(map);

  let marker = null;
  let accuracyCircle = null;
  let watchId = null;
  const statusEl = document.getElementById('status');

  function setStatus(msg) {
    statusEl.textContent = msg;
  }

  function onSuccess(pos) {
    const lat = pos.coords.latitude;
    const lng = pos.coords.longitude;
    const acc = pos.coords.accuracy;
    setStatus(`✅ Lat ${lat.toFixed(6)}, Lng ${lng.toFixed(6)} (accuracy ≈ ${Math.round(acc)} m)`);

    if (!marker) {
      marker = L.marker([lat, lng]).addTo(map);
    } else {
      marker.setLatLng([lat, lng]);
    }

    if (!accuracyCircle) {
      accuracyCircle = L.circle([lat, lng], { radius: acc }).addTo(map);
    } else {
      accuracyCircle.setLatLng([lat, lng]);
      accuracyCircle.setRadius(acc);
    }

    map.setView([lat, lng], 17);
  }

  function onError(err) {
    setStatus(`⚠️ Error: ${err.message}`);
    console.warn(err);
  }

  document.getElementById('findBtn').onclick = () => {
    if (!navigator.geolocation) return setStatus('❌ Geolocation not supported.');

    setStatus('Requesting location… please wait (may take 30–60 s on first try)');
    navigator.geolocation.getCurrentPosition(onSuccess, onError, {
      enableHighAccuracy: true,
      timeout: 60000,      // 60 seconds
      maximumAge: 0
    });
  };

  document.getElementById('watchBtn').onclick = () => {
    if (!navigator.geolocation) return setStatus('❌ Geolocation not supported.');

    setStatus('Watching live location…');
    watchId = navigator.geolocation.watchPosition(onSuccess, onError, {
      enableHighAccuracy: true,
      timeout: 60000,
      maximumAge: 0
    });
    document.getElementById('stopWatchBtn').disabled = false;
  };

  document.getElementById('stopWatchBtn').onclick = () => {
    if (watchId !== null) {
      navigator.geolocation.clearWatch(watchId);
      watchId = null;
      setStatus('Stopped watching.');
      document.getElementById('stopWatchBtn').disabled = true;
    }
  };
</script>

</body>
</html>
